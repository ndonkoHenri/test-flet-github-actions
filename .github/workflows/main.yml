name: Web App Build And Deploy

on:
  # Runs on pushes on the below branch/es
  push:
    branches:
      # - main
      - host-gh-action

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set-up Python 3.12.2
      uses: actions/setup-python@v2
      with:
        python-version: 3.12.2

    - name: Install Python Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
  
    - name: Set up Flutter
      uses: subosito/flutter-action@v2
      with:
        flutter-version: '3.19.0'

    - name: Flet Web Build
      run: flet build web --base-url test-flet-gh --route-url-strategy hash

    - name: Upload Build Artifact
      uses: actions/upload-artifact@v4.3.2
      with:
        name: web-build
        path: build/web
        if-no-files-found: error # Fail the action with an error message if no artifact is found
        overwrite: true # If true, an artifact with a matching name will be deleted before a new one is uploaded. If false, the action will fail if an artifact for the given name already exists. Does not fail if the artifact does not exist.

  # deploy after building
  deploy:
    needs: build  # waits for the "build" job to get done before executing this job
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    steps:
      - name: Setup GitHub Pages
        uses: actions/configure-pages@v5
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4

